heir_spionage_option = {
    category = covert
    
    require_acceptance = no
    
    is_visible = {
        is_subject = no
		government = monarchy
		NOT = { has_reform = elective_monarchy }
		FROM = {
			is_subject = no
			government = monarchy
			NOT = { has_reform = elective_monarchy }
		}
    }
    
    is_allowed = {
        hidden_trigger = {
			is_subject = no
			government = monarchy
			NOT = { has_reform = elective_monarchy }
			FROM = {
				is_subject = no
				government = monarchy
				NOT = { has_reform = elective_monarchy }
			}
		}
		if = {
			limit = { ai = yes }
			treasury = 2500
			legitimacy_equivalent = 80
			OR = {
				NOT = {
					has_opinion = {
						who = FROM
						value = -50
					}
				}
				has_opinion_modifier = {
					modifier = insulted
					who = FROM
				}
				FROM = { has_heir = no }
			}
			num_of_owned_provinces_with = {
				value = 20
				is_core = ROOT
			}
		}
		if = {
			limit = {
				NOT = { has_country_modifier = countdown_next_thronanwaerter_spionage }
			}
			if = {
				limit = { FROM = { government_rank = 3 } }
				treasury = 2500
			}
			else_if = {
				limit = {
					FROM = { government_rank = 2 }
				}
				treasury = 500
			}
			else = {
				treasury = 100
			}
			is_at_war = no
			has_regency = no
			has_spy_network_in = {
				who = FROM
				value = 95
			}
			NOT = { dynasty = FROM }
			FROM = {
				has_regency = no
				ruler_age = 20
				is_at_war = no
				custom_trigger_tooltip = {
					tooltip = HAS_NO_OR_WEAK_HEIR
					OR = {
						has_heir = no
						AND = {
							has_heir = yes
							NOT = { heir_claim = 34 }
						}
					}
				}
				custom_trigger_tooltip = {
					tooltip = HEIR_NOT_ALREADY_SUPPORTED
					NOT = {
						OR = {
							has_country_flag = heir_supported_in_our_country
							has_country_modifier = just_got_pretender_rebels
						}
					}
				}
			}
		}
		else = {
			custom_trigger_tooltip = {
				tooltip = WE_HAVE_NOT_SUPPORTED_REBELS_RECENTLY
				always = no
			}
		}
    }
    
    on_accept = {
        FROM = { 
			country_event = { 
				id = lukat_heir_events.1
			}
		}
		add_spy_network_in = {
			who = FROM
			value = -95
		}
		if = {
			limit = {
				FROM = { government_rank = 3 }
			}
			add_treasury = -2500
		}
		else_if = {
			limit = {
				FROM = { government_rank = 2 }
			}
			add_treasury = -500
		}
		else = {
			add_treasury = -100
		}
		set_country_flag = supported_heir_at_@FROM
		add_country_modifier = {
			name = countdown_next_heir_spionage
			duration = 3650
			hidden = yes
		}
		export_to_variable = {
			which = year_of_last_try_to_support_heir_by_our_country
			value = trigger_value:is_year
		}
		change_variable = { which = year_of_last_try_to_support_heir_by_our_country value = -1 }
    }
    
    ai_will_do = {
		NOT = {
			calc_true_if = {
				all_country = {
					dynasty = ROOT
				}
				amount = 5
			}
		}
		army_size = FROM
		FROM = {
			OR = {
				ai = yes
				AND = {
					ai = no
					NOT = { alliance_with = ROOT }
					NOT = { historical_friend_with = ROOT }
					OR = {
						NOT = {
							reverse_has_opinion = {
								who = ROOT
								value = 0
							}
						}
						reverse_has_opinion_modifier = {
							modifier = insulted
							who = ROOT
						}
					}
				}
			}
		}
	}
}